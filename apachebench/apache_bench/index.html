<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="ja"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="ja"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="ja"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>ポイントだけ ApacheBench &#8211; IT調べものブログ</title>
<meta name="description" content="ポイントだけ ApacheBench">
<meta name="keywords" content="Apache, ab, ApacheBench">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="ポイントだけ ApacheBench">
<meta name="twitter:description" content="ポイントだけ ApacheBench">
<meta name="twitter:creator" content="@handycola">

<!-- Open Graph -->
<meta property="og:locale" content="ja_JP">
<meta property="og:type" content="article">
<meta property="og:title" content="ポイントだけ ApacheBench">
<meta property="og:description" content="ポイントだけ ApacheBench">
<meta property="og:url" content="/apachebench/apache_bench/">
<meta property="og:site_name" content="IT調べものブログ">





<link rel="canonical" href="/apachebench/apache_bench/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="IT調べものブログ Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/ext.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">




<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
(adsbygoogle = window.adsbygoogle || []).push({
google_ad_client: "ca-pub-7938855665302783",
enable_page_level_ads: true
});
</script>

</head>

<body id="page" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">Home</a></li>
		<li>
			<a href="#">投稿</a>
			<ul class="dl-submenu">
				<li><a href="/posts/">全ての投稿</a></li>
				<li><a href="/tags/">タグ</a></li>
			</ul>
		</li>
		<li>
			<a href="#">運営者</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/avatar.jpg" alt="sankame photo" class="author-photo">
					<h4>sankame</h4>
					<p>老舗ネット企業で働くプログラマー。<br>千葉県在住。</p>
				</li>
				<!-- <li><a href="/about/"><span class="btn btn-inverse">Learn More</span></a></li> -->
				<li>
					<a href="mailto:m2ad0504@outlook.jp"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/handycola" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="http://facebook.com/100014073908728" target="_blank"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				
				
				<li>
					<a href="http://github.com/Sankame" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				<li>
					<a href="http://stackoverflow.com/users/2849068/sankame" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> Stackoverflow</a>
				</li>

				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		
	    
	        
	    
	    <!-- <li><a href="/theme-setup/" >Theme Setup</a></li> -->
	  
	    
	        
	        
	    <!-- <li><a href="http://mademistakes.com" target="_blank">External Link</a></li> -->
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        <h1 class="entry-title">ポイントだけ ApacheBench</h1>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~2 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive_header -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7938855665302783"
     data-ad-slot="5752348355"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
      <p><span style="float:right;">投稿日：2014年06月06日</span></p>

<h5>0.環境</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">  [CentOS]      5.6 (32bit版カーネル)
  [Apache]      2.2.3
  [ApacheBench] 2.0.40-dev
</code></pre></div>
<h5>1.基本</h5>

<ul>
<li><p>実行</p>

<p>Apacheをインストールすると ab というコマンドで負荷テストが行えます。</p>

<p>主に使うのは2つのオプションで、下記のように実行します。</p>

<p>後述の &quot;Requests per second&quot; が十分な値になるよう、n と c の値を増やして負荷をかけます。</p>

<p>(n : リクエスト数　c : 同時接続数)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ab -n 10000 -c 100 &quot;http://test.vm/test.php&quot;
</code></pre></div>
<p>※abでテストできるのはサーバ側の処理だけなので、HTMLレンダリングやJavascript実行等、</p>

<p>　トータルの計測を行いたい場合は、下記のようなツールを検討して下さい。</p>

<p><a href="http://gtmetrix.com/">GTmetrix</a></p>

<p><a href="http://knowledge.sakura.ad.jp/tech/1599/">PageSpeed</a></p></li>
<li><p>結果</p>

<p>下記のような実行結果が表示されるので、主に2つの項目を確認します。</p>

<ul>
<li><p>Failed requests (失敗したリクエスト数)</p>

<p>この項目が0であることを確認します。</p>

<p>但し、表示毎にHTMLのバイト数が異なるサイトの場合、ここがカウントされ、さらに内訳を表す &quot;Length:&quot; もカウントされます。</p>

<p>(1つ前の結果とHTMLのバイト数を比較し、異なる場合は Length がカウントされる仕様)</p>

<p>上記のようなサイトの場合、&quot;Failed requests&quot; に数字があっても、全て Length が原因ならば無視してかまいませんが、</p>

<p>念のため、Apacheのアクセスログを確認し、HTTP Response Code が全て200になっていることを確認して下さい。</p></li>
<li><p>Requests per second (秒間に処理したリクエスト数)</p>

<p>対象WEBサイトのアクセス数などから算出した基準を達成しているか確認します。</p>

<p>(例) 月間 1億 PVのサイトの場合、アクセスが均等という前提で、秒間 38.5 リクエストは達成する必要がありそうです。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">100,000,000 / 30 / 24 / 60 / 60 ≒ 38.5
</code></pre></div>
<p><code>(注意) 下記 &quot;ab 実行結果&quot; は文字を表示するだけのページなので &quot;Requests per second&quot; はかなり高い数字になっています。</code></p></li>
<li><p>ab 実行結果</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># ab -n 10000 -c 100 &quot;http://test.vm/test.php&quot;

This is ApacheBench, Version 2.0.40-dev &lt;$Revision: 1.146 $&gt; apache-2.0
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Copyright 2006 The Apache Software Foundation, http://www.apache.org/

Benchmarking test.vm (be patient)
Completed 1000 requests
Completed 2000 requests
Completed 3000 requests
Completed 4000 requests
Completed 5000 requests
Completed 6000 requests
Completed 7000 requests
Completed 8000 requests
Completed 9000 requests
Finished 10000 requests

Server Software:        Apache/2.2.3
Server Hostname:        test.vm
Server Port:            80

Document Path:          /test.php
Document Length:        80 bytes

Concurrency Level:      100
Time taken for tests:   5.772060 seconds
Complete requests:      10000
Failed requests:        9899
   (Connect: 0, Length: 9899, Exceptions: 0)
Write errors:           0
Total transferred:      2418216 bytes
HTML transferred:       499081 bytes
Requests per second:    1732.48 [#/sec] (mean)
Time per request:       57.721 [ms] (mean)
Time per request:       0.577 [ms] (mean, across all concurrent requests)
Transfer rate:          409.04 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.3      0       6
Processing:     5   56 112.2     55    5769
Waiting:        5   54  77.3     55    4398
Total:          5   57 112.2     55    5769

Percentage of the requests served within a certain time (ms)
  50%     55
  66%     56
  75%     58
  80%     59
  90%     62
  95%     69
  98%     77
  99%    284
 100%   5769 (longest request)
</code></pre></div></li>
</ul></li>
</ul>

<h5>2.応用</h5>

<ul>
<li><p>コマンドサンプル</p>

<p>他によく使うオプションを記載しておきます。</p>

<p>Cookieを指定。(C : [Cookie名]=[値])</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ab -n 100 -c 10 -C &#39;id=test&#39; &quot;http://test.vm/test.php&quot;
</code></pre></div>
<p>複数のCookieを指定。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ab -n 100 -c 10 -C &#39;id=test;flag=1&#39; &quot;http://test.vm/test.php&quot;
</code></pre></div></li>
<li><p>host名の指定が必要な場合</p>

<p>host名の指定が必須のWEBサイトで、かつ ab 実行環境で /etc/hosts に記載ができない場合、</p>

<p>下記のようにヘッダオプション(-H) と Host を使います。</p>

<p>これに対応した ab はApache 2.2.22 以降で、自分の環境は未対応だったのでソースを落としてきてビルドしました。</p>

<p><code>(注意) ab を使うだけなので、Apacheのインストール(make install)は行わない。</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># cd /usr/local/src/
# wget http://ftp.meisei-u.ac.jp/mirror/apache/dist//httpd/httpd-2.2.27.tar.gz
# tar xzf httpd-2.2.27.tar.gz
# cd httpd-2.2.27
# ./configure
# make
# 
# /usr/local/src/httpd-2.2.27/support/ab -n 100 -c 10 -H &#39;Host: test.vm&#39; &quot;http://192.168.130.130/test.php&quot;
#
# /usr/local/src/httpd-2.2.27/support/ab -V
#This is ApacheBench, Version 2.3 &lt;$Revision: 655654 $&gt;
</code></pre></div></li>
</ul>

      <br>
      <br>
      <div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive_bottom1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7938855665302783"
     data-ad-slot="4136014354"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<br>
<br>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive_bottom2 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7938855665302783"
     data-ad-slot="7089480753"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
      <br>
      <br>
      <span><a href="https://jcal.ml" target="_blank">ところで今年は平成何年？</a></span>
      <br>
      <br>
      <span><a href="https://twitter.com/handycola" class="twitter-follow-button" data-show-count="false" data-lang="ja" data-size="large" data-show-screen-name="false" data-dnt="true">@handycolaさんをフォロー</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></span>
      <footer class="entry-meta">
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/apachebench/apache_bench/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/apachebench/apache_bench/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/apachebench/apache_bench/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->

  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 sankame. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37675354-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>



</body>
</html>
