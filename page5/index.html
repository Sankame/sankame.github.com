<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>最近の投稿 &#8211; IT調べものブログ</title>
<meta name="description" content="IT系の調べ物を思い出すためのブログです。">

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/abstract-1.jpg">

<meta name="twitter:title" content="最近の投稿">
<meta name="twitter:description" content="IT系の調べ物を思い出すためのブログです。">
<meta name="twitter:creator" content="@handycola">

<!-- Open Graph -->
<meta property="og:locale" content="ja_JP">
<meta property="og:type" content="article">
<meta property="og:title" content="最近の投稿">
<meta property="og:description" content="IT系の調べ物を思い出すためのブログです。">
<meta property="og:url" content="/page5/index.html">
<meta property="og:site_name" content="IT調べものブログ">





<link rel="canonical" href="/page5/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="IT調べものブログ Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/ext.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">Home</a></li>
		<li>
			<a href="#">投稿</a>
			<ul class="dl-submenu">
				<li><a href="/posts/">全ての投稿</a></li>
				<li><a href="/tags/">タグ</a></li>
			</ul>
		</li>
		<li>
			<a href="#">運営者</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/avatar.jpg" alt="sankame photo" class="author-photo">
					<h4>sankame</h4>
					<p>老舗ネット企業で働くプログラマー。<br>千葉県在住。</p>
				</li>
				<!-- <li><a href="/about/"><span class="btn btn-inverse">Learn More</span></a></li> -->
				<li>
					<a href="mailto:m2ad0504@outlook.jp"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/handycola" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				
				
				<li>
					<a href="http://github.com/Sankame" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				<li>
					<a href="http://stackoverflow.com/users/2849068/sankame" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> Stackoverflow</a>
				</li>

				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		
	    
	        
	    
	    <!-- <li><a href="/theme-setup/" >Theme Setup</a></li> -->
	  
	    
	        
	        
	    <!-- <li><a href="http://mademistakes.com" target="_blank">External Link</a></li> -->
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  
  
    <div class="entry-image">
      <img src="/images/abstract-1.jpg" alt="最近の投稿">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>IT調べものブログ</h1>
      <h2>最近の投稿</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-06-06T20:00:00-04:00"><a href="/apachebench/apache_bench/">June 06, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About sankame">sankame</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~2 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/apachebench/apache_bench/" rel="bookmark" title="ポイントだけ ApacheBench" itemprop="url">ポイントだけ ApacheBench</a></h1>
    
  </header>
  <div class="entry-content">
    <p><span style="float:right;">投稿日：2014年06月06日</span></p>

<h5>0.環境</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">  [CentOS]      5.6 (32bit版カーネル)
  [Apache]      2.2.3
  [ApacheBench] 2.0.40-dev
</code></pre></div>
<h5>1.基本</h5>

<ul>
<li><p>実行</p>

<p>Apacheをインストールすると ab というコマンドで負荷テストが行えます。</p>

<p>主に使うのは2つのオプションで、下記のように実行します。</p>

<p>後述の &quot;Requests per second&quot; が十分な値になるよう、n と c の値を増やして負荷をかけます。</p>

<p>(n : リクエスト数　c : 同時接続数)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ab -n 10000 -c 100 &quot;http://test.vm/test.php&quot;
</code></pre></div>
<p>※abでテストできるのはサーバ側の処理だけなので、HTMLレンダリングやJavascript実行等、</p>

<p>　トータルの計測を行いたい場合は、下記のようなツールを検討して下さい。</p>

<p><a href="http://gtmetrix.com/">GTmetrix</a></p>

<p><a href="http://knowledge.sakura.ad.jp/tech/1599/">PageSpeed</a></p></li>
<li><p>結果</p>

<p>下記のような実行結果が表示されるので、主に2つの項目を確認します。</p>

<ul>
<li><p>Failed requests (失敗したリクエスト数)</p>

<p>この項目が0であることを確認します。</p>

<p>但し、表示毎にHTMLのバイト数が異なるサイトの場合、ここがカウントされ、さらに内訳を表す &quot;Length:&quot; もカウントされます。</p>

<p>(1つ前の結果とHTMLのバイト数を比較し、異なる場合は Length がカウントされる仕様)</p>

<p>上記のようなサイトの場合、&quot;Failed requests&quot; に数字があっても、全て Length が原因ならば無視してかまいませんが、</p>

<p>念のため、Apacheのアクセスログを確認し、HTTP Response Code が全て200になっていることを確認して下さい。</p></li>
<li><p>Requests per second (秒間に処理したリクエスト数)</p>

<p>対象WEBサイトのアクセス数などから算出した基準を達成しているか確認します。</p>

<p>(例) 月間 1億 PVのサイトの場合、アクセスが均等という前提で、秒間 38.5 リクエストは達成する必要がありそうです。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">100,000,000 / 30 / 24 / 60 / 60 ≒ 38.5
</code></pre></div>
<p><code>(注意) 下記 &quot;ab 実行結果&quot; は文字を表示するだけのページなので &quot;Requests per second&quot; はかなり高い数字になっています。</code></p></li>
<li><p>ab 実行結果</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># ab -n 10000 -c 100 &quot;http://test.vm/test.php&quot;

This is ApacheBench, Version 2.0.40-dev &lt;$Revision: 1.146 $&gt; apache-2.0
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Copyright 2006 The Apache Software Foundation, http://www.apache.org/

Benchmarking test.vm (be patient)
Completed 1000 requests
Completed 2000 requests
Completed 3000 requests
Completed 4000 requests
Completed 5000 requests
Completed 6000 requests
Completed 7000 requests
Completed 8000 requests
Completed 9000 requests
Finished 10000 requests

Server Software:        Apache/2.2.3
Server Hostname:        test.vm
Server Port:            80

Document Path:          /test.php
Document Length:        80 bytes

Concurrency Level:      100
Time taken for tests:   5.772060 seconds
Complete requests:      10000
Failed requests:        9899
   (Connect: 0, Length: 9899, Exceptions: 0)
Write errors:           0
Total transferred:      2418216 bytes
HTML transferred:       499081 bytes
Requests per second:    1732.48 [#/sec] (mean)
Time per request:       57.721 [ms] (mean)
Time per request:       0.577 [ms] (mean, across all concurrent requests)
Transfer rate:          409.04 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.3      0       6
Processing:     5   56 112.2     55    5769
Waiting:        5   54  77.3     55    4398
Total:          5   57 112.2     55    5769

Percentage of the requests served within a certain time (ms)
  50%     55
  66%     56
  75%     58
  80%     59
  90%     62
  95%     69
  98%     77
  99%    284
 100%   5769 (longest request)
</code></pre></div></li>
</ul></li>
</ul>

<h5>2.応用</h5>

<ul>
<li><p>コマンドサンプル</p>

<p>他によく使うオプションを記載しておきます。</p>

<p>Cookieを指定。(C : [Cookie名]=[値])</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ab -n 100 -c 10 -C &#39;id=test&#39; &quot;http://test.vm/test.php&quot;
</code></pre></div>
<p>複数のCookieを指定。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ab -n 100 -c 10 -C &#39;id=test;flag=1&#39; &quot;http://test.vm/test.php&quot;
</code></pre></div></li>
<li><p>host名の指定が必要な場合</p>

<p>host名の指定が必須のWEBサイトで、かつ ab 実行環境で /etc/hosts に記載ができない場合、</p>

<p>下記のようにヘッダオプション(-H) と Host を使います。</p>

<p>これに対応した ab はApache 2.2.22 以降で、自分の環境は未対応だったのでソースを落としてきてビルドしました。</p>

<p><code>(注意) ab を使うだけなので、Apacheのインストール(make install)は行わない。</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># cd /usr/local/src/
# wget http://ftp.meisei-u.ac.jp/mirror/apache/dist//httpd/httpd-2.2.27.tar.gz
# tar xzf httpd-2.2.27.tar.gz
# cd httpd-2.2.27
# ./configure
# make
# 
# /usr/local/src/httpd-2.2.27/support/ab -n 100 -c 10 -H &#39;Host: test.vm&#39; &quot;http://192.168.130.130/test.php&quot;
#
# /usr/local/src/httpd-2.2.27/support/ab -V
#This is ApacheBench, Version 2.3 &lt;$Revision: 655654 $&gt;
</code></pre></div></li>
</ul>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-06-03T20:00:00-04:00"><a href="/selenium/jenkins_selenium/">June 03, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About sankame">sankame</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/selenium/jenkins_selenium/" rel="bookmark" title="Jenkins から Seleniumを動かしてみる" itemprop="url">Jenkins から Seleniumを動かしてみる</a></h1>
    
  </header>
  <div class="entry-content">
    <p><span style="float:right;">投稿日：2014年06月03日</span></p>

<h3>0.環境</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">・親ノード端末
  [CentOS]   5.6 (32bit版カーネル)
  [ruby]     2.1.1p76
  [rvm]      1.25.25
  [java]     1.7.0_51
  [Jenkins]  1.562

・子ノード端末
  [Windows]  Vista Home Premium (32bit)
  [java]     1.7.0_51
  [IE]       8
</code></pre></div>
<h3>1.準備</h3>

<ul>
<li><p>Jenkinsインストール</p>

<p>下記のリンクを参考にJenkinsをインストールしました。</p>

<p><a href="http://d.hatena.ne.jp/katsuren/20121030/1351569655">俺の成長日記</a></p>

<p><a href="http://oscasierra.net/2013/05/jenkins-to-redhat/">OSCALOG</a></p>

<p><a href="http://kohkimakimoto.hatenablog.com/entry/2013/11/22/192646">JenkinsをCentOSにインストールしたときのメモ</a></p></li>
<li><p>前回の続き</p>

<p>親ノードと子ノードでSelenium Serverを起動します。(下記リンク参照)</p>

<p><a href="/Selenium/2014/05/24/selenium_webdriver/">Selenium WebDriverを動かしてみる</a></p>

<p>前回と異なる点は、Jenkinsがポート4444を使っていたので、Selenium Serverは4445を使って起動します。</p>

<p>・親ノード</p>
<div class="highlight"><pre><code class="language-java" data-lang="java">    <span class="err">#</span> <span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="n">selenium</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">standalone</span><span class="o">-</span><span class="mf">2.41</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="na">jar</span> <span class="o">-</span><span class="n">role</span> <span class="n">hub</span> <span class="o">-</span><span class="n">port</span> <span class="mi">4445</span>
</code></pre></div>
<p>・子ノード</p>
<div class="highlight"><pre><code class="language-java" data-lang="java">    <span class="o">&gt;</span> <span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="n">selenium</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">standalone</span><span class="o">-</span><span class="mf">2.41</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="na">jar</span> <span class="o">-</span><span class="n">role</span> <span class="n">webdriver</span> <span class="o">-</span><span class="n">hub</span> <span class="nl">http:</span><span class="c1">//192.168.130.130:4445/grid/register -Dwebdriver.ie.driver=./IEDriverServer.exe</span>
</code></pre></div></li>
<li><p>Jenkins プラグイン追加</p>

<p>rvmでrubyを使っているので、予めJenkinsにrvmプラグインを追加。</p>

<p>Jenkinsのダッシュボードから[Jenkinsの管理]-[プラグインの管理]-[利用可能]</p>

<p>右上のフィルターでrvmと打つとRVMプラグインが表示されるのでチェックをつけ、[再起動せずにインストール]クリック。</p>

<p>(インストールは何回か失敗することがあります)</p></li>
<li><p>Jenkins ジョブ追加</p>

<p>Jenkinsのダッシュボードから[新規ジョブ作成]、ジョブ名を入力し、[フリースタイル・プロジェクトのビルド]を選択して[OK]クリック。</p>

<p>ビルド環境のRVMで使用したいrubyのバージョンを指定。(自分の場合 2.1.1) (下図参照)</p>

<p>シェルスクリプトで下記のように指定。(パス等は読み替えて下さい) (下図参照)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/usr/local/rvm/rubies/ruby-2.1.1/bin/ruby /app/seleniumtest/seleniumtest_4445.rb
</code></pre></div>
<p>「保存」ボタンクリック。</p>

<p><a href="/assets/posts/img/jenkins_selenium/jenkins_project.png" target="_blank"><img width="50%" height="50%" title="Jenkinsプロジェクト設定" alt="Jenkinsプロジェクト設定" src="/assets/posts/img/jenkins_selenium/jenkins_project.png"></a></p></li>
<li><p>rubyスクリプト</p>

<p>上記でJenkinsに設定した &quot;seleniumtest_4445.rb&quot; は以下の内容です。(ポート番号4445でアクセス)</p>

<script src="https://gist.github.com/dc5fb2d680b67acefbf3.js?file=seleniumtest_4445.rb"> </script></li>
</ul>

<h3>2.起動</h3>

<ul>
<li><p>ビルド実行</p>

<p>上記で作成したジョブで「ビルド実行」をクリック。</p>

<p>子ノードでIEが起動すれば成功です。</p></li>
</ul>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-05-23T20:00:00-04:00"><a href="/selenium/selenium_webdriver/">May 23, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About sankame">sankame</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/selenium/selenium_webdriver/" rel="bookmark" title="Selenium WebDriverを動かしてみる" itemprop="url">Selenium WebDriverを動かしてみる</a></h1>
    
  </header>
  <div class="entry-content">
    <p><span style="float:right;">投稿日：2014年05月23日</span></p>

<h5>0.環境</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">・親ノード端末
  [CentOS]   5.6 (32bit版カーネル)
  [ruby]     2.1.1p76
  [rvm]      1.25.25
  [java]     1.7.0_51

・子ノード端末
  [Windows]  Vista Home Premium (32bit)
  [java]     1.7.0_51
  [IE]       8
</code></pre></div>
<h5>1.準備</h5>

<ul>
<li><p>動機</p>

<p>ブラウザテストの自動化に興味があり、面白そうな記事があったので自分でも試してみました。</p>

<p>(Jenkinsとの連携は今回やっていません)</p>

<p><a href="http://blog.takuros.net/entry/20130305/1362437720">JenkinsとSelenium WebDriverでUI層のテストも自動化＆永続化する</a></p></li>
<li><p>親ノード</p>

<p>親ノード端末の適当なディレクトリに Selenium Server をダウンロード後、起動します。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># cd /usr/local/bin/
# wget http://selenium-release.storage.googleapis.com/2.41/selenium-server-standalone-2.41.0.jar
# java -jar selenium-server-standalone-2.41.0.jar -role hub
</code></pre></div></li>
<li><p>子ノード</p>

<p>子ノード端末の適当なフォルダに Selenium Server とIEドライバーをダウンロード後、起動します。</p>

<p><a href="http://docs.seleniumhq.org/download/">ダウンロードサイト</a></p>

<p>まず、&quot;Selenium Server (formerly the Selenium RC Server)&quot; をダウンロード。</p>

<p>次に、&quot;The Internet Explorer Driver Server&quot; をダウンロード。</p>

<p>(アーキテクチャによって32bitまたは64bitを選択)</p>

<p>コマンドプロンプトを開いて、ダウンロードしたフォルダに移動し Selenium Server を起動。</p>

<p>(192.168.130.130 は自分の環境の親ノードIPに読み替え)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt; cd C:\apps\selenium
&gt; java -jar selenium-server-standalone-2.41.0.jar -role webdriver -hub http://192.168.130.130:4444/grid/register -Dwebdriver.ie.driver=./IEDriverServer.exe
</code></pre></div>
<p>IEドライバーを起動するには、IEの[ツール]-[インターネットオプション]-[セキュリティ]で全ての</p>

<p>ゾーンの「保護モード」を同じにしておく必要があります。<a href="https://selenium.googlecode.com/issues/attachment?aid=17950019000&amp;name=1.png&amp;token=ABZ6GAdCiZEHCiZBk5mmjW1I9awHy0ZHtQ%3A1400944855099&amp;inline=1">画面キャプチャ</a></p>

<p><a href="http://qiita.com/Kackey/items/c5dded9a6762c1a8cccf">参考記事</a></p></li>
</ul>

<h5>2.起動</h5>

<ul>
<li><p>IE起動</p>

<p>親ノード端末に置いたプログラムから、子ノード端末のIEを起動します。</p>

<p>親ノード端末の適当なディレクトリに下記スクリプトを配置。</p>

<p>(192.168.130.130 は自分の環境の親ノードIPに読み替え)</p>

<script src="https://gist.github.com/105475ff842cd9bf6ad6.js?file=seleniumtest.rb"> </script>

<p>スクリプト内で selenium-webdriver を使っているので、予めインストールしておきます。</p>

<p>(適当なディレクトリへ移動し、依存関係を気にしたくないのでbundleを使ってインストール)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># bundle init
# echo &quot;gem &#39;selenium-webdriver&#39;&quot; &gt;&gt; Gemfile
# bundle install
</code></pre></div>
<p>プログラムを実行し、子ノード端末でIEが起動すれば成功です。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># ruby /app/seleniumtest/seleniumtest.rb
</code></pre></div></li>
</ul>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-05-17T20:00:00-04:00"><a href="/jekyll/jekyll_version_up/">May 17, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About sankame">sankame</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/jekyll/jekyll_version_up/" rel="bookmark" title="Jekyllを1.0.2へバージョンアップ" itemprop="url">Jekyllを1.0.2へバージョンアップ</a></h1>
    
  </header>
  <div class="entry-content">
    <p><span style="float:right;">投稿日：2014年05月17日</span></p>

<h5>0.環境</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">[CentOS]     5.6 (32bit版カーネル)
[ruby]       2.1.1p76
[rvm]        1.25.25
[jekyll]     0.11.2 =&gt; 1.0.2
</code></pre></div>
<h5>1.インストール <a href="http://melborne.github.io/2013/05/20/now-the-time-to-start-jekyll/">参考ページ</a></h5>

<ul>
<li><p>インストール</p>

<p>本ブログはjekyll 0.11.2で作成してきましたが、別件でrubyのバージョンを上げたことでjekyllが動か</p>

<p>なくなってしまったため、思い切って1.0.2への移行を行いました。<a href="http://sankame.github.io/Jekyll/2012/12/23/jekyll_and_github/">初期インストールの内容</a></p>

<p>いくつかハマった点を共有します。</p>

<p>まず、複数バージョンのrubyを使いたかったので下記ページに沿ってrvmをインストール。</p>

<p><a href="http://d.hatena.ne.jp/mrgoofy33/20110518/1305649544">rvmインストール</a></p>

<p>rootで実行したためか /usr/local/rvm にインストールされたので、上記記事内のパスは読み替えました。</p>

<p>ruby 2.1.1をインストール。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># rvm install 2.1.1
# rvm use  2.1.1
</code></pre></div>
<p>適当な場所にGemfileを作成し、jekyllを追記してインストール開始。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># bundle init
# echo &quot;gem &#39;jekyll&#39;, &#39;1.0.2&#39;&quot; &gt;&gt; Gemfile
# bundle install
</code></pre></div>
<p>インストールされたことを確認します。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># gem list|grep jekyll
jekyll (1.0.2)
jekyll-coffeescript (1.0.0)
jekyll-sass-converter (1.0.0)
</code></pre></div></li>
<li><p>起動</p>

<p>任意の場所へ移動し、bootstrapをダウンロードします。<a href="http://jekyllbootstrap.com/usage/jekyll-quick-start.html">bootstrapクイックスタート</a></p>

<p>(前バージョンとは別の場所にしました)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># cd /var/www/html/jekyll2/
# git clone https://github.com/plusjade/jekyll-bootstrap.git
# cd jekyll-bootstrap
# jekyll serve --watch
</code></pre></div></li>
</ul>

<h5>2.引越し</h5>

<ul>
<li><p>ファイルコピー</p>

<p>前バージョンの設定ファイルや記事を新バージョンへコピーします。</p>

<p>(自分の環境に合わせて必要なものをコピーして下さい)</p>

<p>(1) diffを確認しながら部分ごとコピー</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">index.md
_config.yml
categories.html
tags.html
pages.html
archive.html
404.html
</code></pre></div>
<p>(2) ディレクトリ単位で上書きコピー</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">_includes/JB
_includes/themes/twitter
_layouts
_posts
assets
</code></pre></div></li>
<li><p>動かない①</p>

<p>_posts 内でサンプルコードとして下記の記述があると、jekyllが停止してしまいました。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">　&lt;?php
</code></pre></div>
<p>原因が分からなかったので、gistにコード部分をアップしjekyllで読み込ませることにしました。</p>

<p>gistは下記のように記述する必要があります。(【】 内は読み替え)</p>

<p>{% gist     【gistのID】  【ファイル名】 %}</p>

<p>ところが、gistのIDにアルファベットが含まれるのに、jekyll側は数字のみしか対応していなか</p>

<p>ったためローカルjekyllの下記箇所を修正しました。(jekyll 1.x系の最新(1.4)では直ってました)</p>

<p>・ソース</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/usr/local/rvm/gems/ruby-2.1.1/gems/jekyll-1.0.2/lib/jekyll/tags/gist.rb
</code></pre></div>
<p>・修正内容 (IDにアルファベットを許可)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># diff  gist.rb.org  gist.rb
10c10
&lt; if tag_contents = @markup.strip.match(/\A(\d+) ?(\S*)\Z/)
　---
&gt; if tag_contents = @markup.strip.match(/\A([0-9a-fA-F]+) ?(\S*)\Z/)
</code></pre></div></li>
<li><p>動かない②</p>

<p>新旧の記事ページの比較をしていたところ、URLが違うことに気付きました。</p>

<p>前バージョンだと _posts 内の記事のヘッダ部分で定義するカテゴリに大文字を使っている場合、</p>

<p>_site に生成されるディレクトリもそのまま大文字になります。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">category : Jekyll
</code></pre></div>
<p>ところが、新バージョンだと全部小文字に変換され、下記の差が出てしまいます。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">(前バージョン)
http://localhost:4000/Jekyll/2014/05/18/jekyll_version_up/

(新バージョン)
http://localhost:4000/jekyll/2014/05/18/jekyll_version_up/
</code></pre></div>
<p>一度インターネットに公開したURLが変わるのは困ります…</p>

<p>仕方がないので、ローカルのjekyllソースを下記のように修正しました。</p>

<p>・ソース</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/usr/local/rvm/gems/ruby-2.1.1/gems/jekyll-1.0.2/lib/jekyll/post.rb
</code></pre></div>
<p>・修正内容 (小文字変換を削除)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># diff post.rb.org post.rb
79c79
&lt; self.categories = self.data.pluralized_array(&#39;category&#39;, &#39;categories&#39;).map {|c| c.to_s.downcase}
　---
&gt; self.categories = self.data.pluralized_array(&#39;category&#39;, &#39;categories&#39;).map {|c| c.to_s}
</code></pre></div></li>
<li><p>参考ページ</p>

<p><a href="http://melborne.github.io/2013/05/20/now-the-time-to-start-jekyll/">Jekyll Version 1.0</a></p>

<p><a href="http://melborne.github.io/2012/05/13/first-step-of-jekyll/">Jekyllを理解する</a></p>

<p><a href="http://krakenbeal.blogspot.jp/2012/05/ruby-jekyll-jekyll-bootstrap.html">jekyllとjekyll-bootstrapで静的サイトを作る</a></p></li>
</ul>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-05-03T20:00:00-04:00"><a href="/reviveadserver/revive_adserver_install/">May 03, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About sankame">sankame</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/reviveadserver/revive_adserver_install/" rel="bookmark" title="Revive Ad Server インストール (旧OpenX)" itemprop="url">Revive Ad Server インストール (旧OpenX)</a></h1>
    
  </header>
  <div class="entry-content">
    <p><span style="float:right;">投稿日：2014年05月03日</span></p>

<h3>0.環境</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">[CentOS]           5.6 (32bit版カーネル)
[Apache]           2.2.3
[PHP]              5.4.17
[Revive AdServer]  3.0.4
</code></pre></div>
<h3>1.インストール</h3>

<ul>
<li><p>1-0.ダウンロード</p>

<p>適当なディレクトリにソースをダウンロードし、Apache公開ディレクトリへ移動。</p>

<p>(公開ディレクトリは自分の環境に読み替えて下さい)</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c"># wget http://download.revive-adserver.com/revive-adserver-3.0.4.tar.gz</span>
<span class="c"># tar xzf revive-adserver-3.0.4.tar.gz</span>
<span class="c"># mv revive-adserver-3.0.4 revive-adserver</span>
<span class="c"># mv revive-adserver /app/.</span>
</code></pre></div></li>
<li><p>1-1.インストール開始</p>

<p>ブラウザから、上記インストール先URLへアクセス。</p>

<p>(例) http://localhost/revive-adserver</p>

<p>ウィザードに従ってインストールを進めます。</p>

<p><a href="/assets/posts/img/revive_adserver_install/step1.png" target="_blank"><img width="100%" height="100%" title="step1" alt="step1" src="/assets/posts/img/revive_adserver_install/step1.png"></a></p>

<p>&quot;I Agree &gt;&gt;&quot;ボタンを押すと、&quot;File Permissions - 7 errors&quot; というエラーが表示されました。</p>

<p>画面に表示されたコマンドをそのままコンソールで実行。</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c"># chmod -R a+w /app/revive-adserver/var</span>
<span class="c"># chmod -R a+w /app/revive-adserver/var/cache</span>
<span class="c"># chmod -R a+w /app/revive-adserver/var/plugins</span>
<span class="c"># chmod -R a+w /app/revive-adserver/var/templates_compiled</span>
<span class="c"># chmod -R a+w /app/revive-adserver/plugins</span>
<span class="c"># chmod -R a+w /app/revive-adserver/www/admin/plugins</span>
<span class="c"># chmod -R a+w /app/revive-adserver/www/images</span>
</code></pre></div>
<p>再びインストール画面へ戻って&quot;Retry&quot;を押すと、次のステップへ進めます。</p></li>
<li><p>1-2.DB設定</p>

<p>DB情報の入力画面が表示されますが、その前に下記コマンド(※1)でMySQL上にDBを作成。</p>

<p><a href="/assets/posts/img/revive_adserver_install/step2.png" target="_blank"><img width="100%" height="100%" title="step2" alt="step2" src="/assets/posts/img/revive_adserver_install/step2.png"></a></p>

<p>(※1) コマンド (DB名、ユーザ名、パスワードは任意に設定して下さい)</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c"># mysql -h 127.0.0.1 -u root -p</span>
mysql&gt; create database reviveadserver<span class="p">;</span>
mysql&gt; grant all privileges on reviveadserver.* to admin@localhost identified by <span class="s1">&#39;password&#39;</span><span class="p">;</span>
</code></pre></div>
<p>再びインストール画面へ戻り、上記のDB情報を入力後、&quot;Continue &gt;&gt;&quot; を押します。</p></li>
<li><p>1-3.管理ユーザ登録</p>

<p>Revive AdServerの管理ユーザを登録します。</p>

<p><a href="/assets/posts/img/revive_adserver_install/step3.png" target="_blank"><img width="100%" height="100%" title="step3" alt="step3" src="/assets/posts/img/revive_adserver_install/step3.png"></a></p>

<p>言語とタイムゾーンを変更。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Language:  Japanese
Timezone:  (GMT+0900) Asia/Tokyo
</code></pre></div></li>
<li><p>1-4.登録完了</p>

<p>登録完了しました。</p>

<p>「インストール中にエラーが発生しました」と表示されましたが、指定されたログを見てもエラーの記述はありませんでした。</p>

<p><a href="/assets/posts/img/revive_adserver_install/step4.png" target="_blank"><img width="100%" height="100%" title="step4" alt="step4" src="/assets/posts/img/revive_adserver_install/step4.png"></a></p></li>
</ul>

<h3>参考</h3>

<ul>
<li><a href="http://tec-blog.menue.jp/?p=278" target="_blank">Revive Adserver(旧OpenX)で広告配信</a></li>
</ul>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->


<div class="pagination">
  
    
      <a href="/page4" class="btn">Previous</a>
    
  
  <ul class="inline-list">
    <li>
      
        <a href="">1</a>
      
    </li>
    
      <li>
        
          <a href="/page2">2</a>
        
      </li>
    
      <li>
        
          <a href="/page3">3</a>
        
      </li>
    
      <li>
        
          <a href="/page4">4</a>
        
      </li>
    
      <li>
        
          <span class="current-page">5</span>
        
      </li>
    
      <li>
        
          <a href="/page6">6</a>
        
      </li>
    
      <li>
        
          <a href="/page7">7</a>
        
      </li>
    
      <li>
        
          <a href="/page8">8</a>
        
      </li>
    
      <li>
        
          <a href="/page9">9</a>
        
      </li>
    
      <li>
        
          <a href="/page10">10</a>
        
      </li>
    
  </ul>
  
    <a href="/page6" class="btn">Next</a>
  
</div><!-- /.pagination -->

<div>
<div align="center"><font color="#20B2AA" >【免責事項】</font></div><br>
本ブログのご利用につき、何らかのトラブルや損失・損害等につきましては一切責任を問わないものとします。
</div>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 sankame. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37675354-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

          

</body>
</html>